
---
title: 音频相关
description: 
platform: 音频相关
updatedAt: Wed Nov 21 2018 03:51:51 GMT+0000 (UTC)
---
# 音频相关
## 回声

回声问题通常是由对方的设备引起的，佩戴耳机即可规避。

**步骤 1：自检操作**

完成以下的自检操作，确认回声是否已消除:

* 请确保各通话方处于互相隔离的物理环境中（非近场测试）。
* 请检查 SDK 版本，如果低于以下版本，请升级至以下版本再尝试：
     * Android/iOS: v1.6.0 或更高版本
     * Windows/macOS: v1.7.0 或更高版本
* 音频是否使用了自采集模式？该模式SDK不支持回声消除。
* 设备性能是否过度使用，如CPU过高导致录放音不稳定，可从声网提供的水晶球服务中进行确认。
* Windows 平台上，检查在麦克风属性里是否已勾选 监听麦克风 选项，如有，取消该勾选。
* iOS 下，是否设置了 Mixable option，并且有其他音频类应用也在使用 mic，这种情况下可能会出现回声。
* Android 是否有使用 `setAudioProfile` 的 Game Streaming 场景，该模式下回声消除默认关闭。
* 请佩戴耳机。
     * 1 对 1 通话: 如果您听到回声，请让对方佩戴耳机进行通话。
     * 多人通话: 可以请用户轮流静音，找出回声源。引起回声的用户请佩戴耳机，或在无需发言时，请将自己设为静音状态。

如果问题仍然存在，请联系技术支持。

**步骤 2：联系技术支持**

如果问题仍然存在，请联系技术支持，并提供以下信息，方便快速定位问题：

<table>
  <tr>
    <th>信息</th>
    <th>详情</th>
  </tr>
  <tr>
    <td rowspan="4">必要信息</td>
    <td>存在回声的通话频道号</td>
  </tr>
  <tr>
    <td>哪些用户听到了回声，提供他们的 UID</td>
  </tr>
  <tr>
    <td>哪些用户引起了回声，提供他们的 UID，例如，当某个用户加入频道时，其他用户开始听到回声</td>
  </tr>
  <tr>
    <td>录音文件（如果有的话）</td>
  </tr>
  <tr>
    <td rowspan="3">更多信息</td>
    <td>出现回声的具体时间段</td>
  </tr>
  <tr>
    <td>退出频道，再重新加入频道后，该问题是否仍旧存在</td>
  </tr>
  <tr>
    <td>引起回声或听到回声的用户切换语音路由后，该问题是否仍旧存在。 例如：插入耳机，切换为听筒模式等等</td>
  </tr>
</table>

## 噪声/杂声

杂音的问题一般是外部环境或者录放音设备导致的，SDK 本身一般是不会主动产生杂音。

**步骤 1：自检操作**

完成以下的自检操作，确认噪声是否已消除:

* 确认是否为近场测试：通信两端的手机在同一房间内，且处于公放状态，连环增益大于 1 时会产生近场啸叫。
* 是否为音频自采集，采集到的声音是否正常。
* 通话时一方环境是否太过嘈杂（麦克风对着电脑风扇，宿舍很吵，窗外很吵等）。
* 确认录音设备是否正常工作（外置声卡、耳机、麦克风接触不良会造成电流声）。
* 耳机 Mic 晃动或和衣服摩擦也会产生杂音。

**步骤 2：联系技术支持**

如果问题仍旧存在，请联系技术支持，并提供以下信息，方便快速定位问题：

<table>
  <tr>
    <th>信息</th>
    <th>详情</th>
  </tr>
  <tr>
    <td rowspan="3">必要信息</td>
    <td>存在噪声的通话频道号</td>
  </tr>
  <tr>
    <td>哪些用户引起了噪声，提供他们的 UID，例如，当某个用户加入频道时，频道里开始出现噪音</td>
  </tr>
  <tr>
    <td>录音文件（如果有的话）</td>
  </tr>
  <tr>
    <td rowspan="4">更多信息</td>
    <td>出现噪声的具体时间段</td>
  </tr>
  <tr>
    <td>退出频道，再重新加入频道后，该问题是否仍旧存在</td>
  </tr>
  <tr>
    <td>macOS 或 Windows 的设备测试结果是否正常</td>
  </tr>
  <tr>
    <td>是否噪音一直存在，还是只有当你说话时你能听见噪音，而其他用户说话时没有噪音</td>
  </tr>
</table>

## 音量问题

**步骤 1：自检操作**

* 请检查接收方的系统音量是否已调大。
* 请检查该问题是否由您的设备引起的，例如，更换耳机或者其他播放设备，或在您的 PC 店或移动端，测试其他同类 VoIP 引用是否也存在声音小的问题。
* 请确认在通话过程中是否使用了第三方的音频应用，因而改变了音频系统底层的设置或者路由，请开发者自行检查代码逻辑。
* 调用以下 API 获取音量信息，调节音量大小：`enableAudioVolumeIndication`，`adjustRecordingSignalVolume`，`adjustPlaybackSignalVolume`，和 `adjustAudioMixingVolume`。详见各平台的 API 参考说明文档。
* 在 `onAudioRouteChanged` 回调里检查语音路由到听筒还是外放(扬声器)。如果是听筒，请调用 API `setDefaultRouteToSpeakerphone` 将语音路由修改至从外放出声。

**步骤 2：联系技术支持**

如果问题仍然存在，请联系技术支持，并提供以下信息，方便快速定位问题:

* 用户所在的频道名称；
* 哪些用户反映音量过小，请提供他们的 UID；
* 用户发现音量过小的时间段。

### 直播模式下上麦或下麦时音量为什么变化？这个可以避免吗？

为了保证不同模式下更好的音质体验，默认情况下上下麦 SDK 会调整底层音频的设置。简单来说，非连麦模式下会使用媒体音量控制，连麦模式下会使用通话音量控制，两者有独立的音量控制机制。

如果想要避免音量变化，可通过 AudioProfile 中 Scenario 的设置来指定通话音量或者媒体音量，Android 平台建议使用 CHATROOM_ENTERTAINMENT，iOS 平台建议使用 GAME_STREAMING 模式。

## 听不到声音

用户在通话过程无法听到对方的声音，或者其他人听不到他的声音，或者双方都听不到。

**步骤 1：自检操作**

完成以下的自检操作，确认问题是否已消除：

* 请确保双方已成功加入频道，是否收到 `onJoinChannelSuccess` 回调事件。
* 请检查是否误操作将自己或对方设为了静音状态。
* 请检查是否调用了SDK相关接口主动静音：`adjustRecordingSignalVolume` 或 `adjustPlaybackSignalVolume`。
* 请检查录音设备是否能录音成功。您可以调用API方法 startEchoTest 进行测试。
* 请确认耳机是否正常工作。
* 请调用 API `setEnableSpeakphone` 进行设置，在外放模式下，插入耳机是没有声音的。
* 如果确认已将语音路由到耳机，请检查耳机是否正常工作。
* 请从 Agora 官网下在 Agora Video Call 的 demo 程序，检测您的设备是否正常。
*  Windows 平台上，如果用户通过外放或耳机听不到声音，可采取下列措施进行排查：
    a. 右键点击 扬声器，选择 **声音**。
      ![](https://web-cdn.agora.io/docs-files/1539250125960)
    b. 在 播放 页签下，确认图中绿色部分是否随着播放的音量大小发生变化。不然，说明播放设备无法正常工作。
      ![](https://web-cdn.agora.io/docs-files/1539250142841)
      如果绿色部分随着播放的音量大小而变化，确认使用其他程序能否听到声音。如果能听见声音，说明是你的 App 存在问题。 如果无论使用哪个程序，绿色部分均不出现，尝试插拔耳机，更换播放设备，或静音再重启播放设备。
    c. 如果上述所有方法均不见效，采取下列措施检查录音设备是否正常工作：
 点开 **录制** 页签，确认图中高亮的绿色是否会随着讲话声音发生变化。如有多台设备，请选择一台合适的设备进行测试。
      ![](https://web-cdn.agora.io/docs-files/1539250157020)

**步骤 2：联系技术支持**

如果问题仍然存在，请联系技术支持，并提供以下信息：
* 用户无法听到声音的频道号
* 该频道内哪些用户无法听到声音，请提供他们的 UID
* 用户无法听到声音的时间段

## 卡顿/不流畅

卡顿/断断续续的问题可能涉及到网络，设备，物理环境等原因。比较常见的是客户端的网络较差导致。

**步骤 1：自检操作**

检查网络状况是否良好。可以换到 4G 或更稳定的 WiFi 环境下再尝试。

也可通过声网提供的水晶球服务，确认用户的网络、设备 CPU 使用是否正常。

**步骤 2：联系技术支持**

如果问题仍旧存在，请联系技术支持，并提供以下信息，方便快速定位问题：

<table>
  <tr>
    <th>信息</th>
    <th>详情</th>
  </tr>
  <tr>
    <td rowspan="4">必要信息</td>
    <td>用户听到语音卡顿的频道名</td>
  </tr>
  <tr>
    <td>哪些用户听到了语音卡顿，提供他们的 UID</td>
  </tr>
  <tr>
    <td>哪些用户造成了语音卡顿，提供他们的 UID</td>
  </tr>
  <tr>
    <td>录音文件（如果有的话）</td>
  </tr>
  <tr>
    <td rowspan="2">可选信息</td>
    <td>如果是直播场景，卡顿是否来自于主播</td>
  </tr>
  <tr>
    <td>如果频道内显示了视频，检查视频播放是否流畅、清晰</td>
  </tr>
</table>

## iOS 蓝牙耳机相关问题

iOS 会自动为系统电话和 VoIP 通话选择音频路由。即使用户连接了蓝牙设备已经连接，也不一定使用蓝牙接听电话。

### 系统电话（包括 CallKit）

系统来电时：

* 如果用户是在 iPhone 设备上按了接听键，来电默认走 iPhone 听筒；
* 如果用户是在蓝牙设备上按了接听键，来电默认走蓝牙。

系统的默认行为可以设置，在 iPhone 的 **设置 > 通用 > 辅助功能 > 音频通话方式**，上述行为是默认的自动。如果设为蓝牙耳机，则来电的时候即使在手机接听，也默认走蓝牙耳机。

在系统电话过程中，用户可以通过通话界面的外放按钮自行切换 **蓝牙**、**听筒**或**外放**。

### VoIP 通话

在发起 VoIP 通话的时候，系统会自动选择音频路由为：当前蓝牙设备连接后的最后一次系统电话或 VoIP 通话所使用的音频路由。如果蓝牙设备连接后没有过系统通话则使用蓝牙。

在 VoIP 通话过程中，用户可以通过系统控制中心（从屏幕下方上滑）自主切换音频路由。程序则可以通过 `setPreferredInput` 接口切换路由。

### 其他设定

用户指定或者程序指定了蓝牙设备为输入或输出时，系统会自动把输出或输入也切到蓝牙。不支持输入输出在两个不同设备上。

无线蓝牙音箱的录音功能只有系统电话级的才可以使用，如：系统电话、FaceTime、或 CallKit。

### 常见问题

Q：用蓝牙耳机在 Premium 的通话中，这时候接听了一个系统电话，再回 Premium 变成听筒了？
A：点了 iPhone 的接听按钮，系统电话和 VoIP 的默认路由变成了 iPhone 听筒。如果用蓝牙耳机上的按钮接听系统电话，再回 Premium 就能保持蓝牙耳机。

Q：iPhone 连着蓝牙耳机，但是 Premium 加入频道就自动变成听筒或外放？
A：说明当前系统电话和 VoIP 的默认路由不是蓝牙耳机。Premium 通话的时候，在系统控制中心（从屏幕下方上滑）中手动切到蓝牙设备，下次再加入频道就默认是蓝牙了。

Q：为什么音乐播放可以自动切回蓝牙？
A：音乐播放不是 VoIP 通话，没有这个行为。

Q：为什么连着蓝牙音箱，进入通话是听筒或外放？
A：除非使用 CallKit 框架，不然一个 App 的通话是无法由无线蓝牙音箱录音的，也就导致了无法使用无线蓝牙音箱播放。直播的观众模式，因为不需要录音，所以可以使用无线蓝牙音箱播放。



